// Generated by CoffeeScript 1.7.1
(function() {
  this.app.controller('ColaborateCtrl', function($scope, $state, $stateParams, $http, ListsSrv, ItemSrv) {
    var api;
    api = 'http://scrooge.reziga.eu/app_dev.php/api/';
    $scope.list = {
      id: 4
    };
    ListsSrv.list.id = 4;
    ItemSrv.init_item($scope);
    ItemSrv.items_from_list($scope.list.id);
    console.log('auieauie');
    $scope.$on("ping", function(e, count) {
      return console.log(count);
    });
    $scope.$on("load_items", function(e, items) {
      var item, _i, _len, _results;
      _results = [];
      for (_i = 0, _len = items.length; _i < _len; _i++) {
        item = items[_i];
        _results.push($scope.items.sync.push($scope.transpose_item(item)));
      }
      return _results;
    });
    $scope.transpose_item = function(item) {
      var normal_item;
      return normal_item = {
        product: item.name,
        quantity: item.quantity,
        id: item.id,
        unity: item.unit
      };
    };
    $scope.add_item = function() {
      var item, item_api, url;
      console.log('touffu .com');
      item = $scope.item;
      if (item.product !== null && item.quantity !== null && item.unity) {
        item_api = {
          item: {
            name: item.product,
            quantity: item.quantity,
            shopList: ListsSrv.list.id,
            unit: item.unity
          }
        };
        url = "" + api + "items/news";
        return $http.post(url, item_api).success(function(data) {
          var new_item;
          new_item = $scope.transpose_item(data);
          $scope.items.sync.push(new_item);
          return $scope.item = {};
        }).error(function(data) {
          console.log('nope nope nope');
          return console.log(data);
        });
      }
    };
    return $scope.delete_item = function(item) {
      var url;
      url = "" + api + "items/" + item.id;
      return $http["delete"](url).success((function(_this) {
        return function(data) {
          var cleaned_items, i, _i, _len, _ref;
          cleaned_items = [];
          _ref = $scope.items.sync;
          for (_i = 0, _len = _ref.length; _i < _len; _i++) {
            i = _ref[_i];
            if (i.id + "" !== item.id + "") {
              cleaned_items.push(i);
            }
          }
          return $scope.items.sync = cleaned_items;
        };
      })(this)).error(function(data) {
        console.log('nope nope nope');
        return console.log(data);
      });
    };
  });

}).call(this);
