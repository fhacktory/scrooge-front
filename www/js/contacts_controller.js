// Generated by CoffeeScript 1.7.1
(function() {
  this.app.controller('ContactsCtrl', function($scope, $state, $stateParams, $http, ListsSrv, ContactsSrv) {
    var api;
    api = 'http://scrooge.reziga.eu/app_dev.php/api/';
    $scope.list = {
      id: 4
    };
    ListsSrv.list.id = 4;
    ContactsSrv.init_contact($scope);
    ContactsSrv.contacts_from_list($scope.list.id);
    $scope.create_list_finsh_step_sheare = function() {
      return $state.go('app.listnew_step_message');
    };
    $scope.$on("load_contacts", function(e, contacts) {
      return $scope.transpose_contacts(contacts);
    });
    $scope.transpose_contacts = function(contacts) {
      var contact, _i, _len, _results;
      _results = [];
      for (_i = 0, _len = contacts.length; _i < _len; _i++) {
        contact = contacts[_i];
        _results.push($scope.contacts.sync.push($scope.transpose_contact(contact)));
      }
      return _results;
    };
    $scope.transpose_contact = function(contact) {
      var normal_contact;
      return normal_contact = {
        mail: contact.email,
        id: contact.id
      };
    };
    $scope.add_contact = function() {
      var contact, contact_api, url;
      console.log('touffu .com');
      contact = $scope.contact;
      contact_api = {
        users: [contact.mail]
      };
      url = "" + api + "shoplists/" + $scope.list.id + "/sharedusers/adds";
      return $http.post(url, contact_api).success(function(data) {
        var new_contacts;
        $scope.contacts.sync = [];
        new_contacts = $scope.transpose_contacts(data.shared_users);
        return $scope.contact = {};
      }).error(function(data) {
        console.log('nope nope nope');
        return console.log(data);
      });
    };
    return $scope.delete_contact = function(contact) {
      var url;
      url = "" + api + "sharedusers/" + contact.id;
      return $http["delete"](url).success((function(_this) {
        return function(data) {
          var cleaned_contacts, i, _i, _len, _ref;
          cleaned_contacts = [];
          _ref = $scope.contacts.sync;
          for (_i = 0, _len = _ref.length; _i < _len; _i++) {
            i = _ref[_i];
            if (i.id + "" !== contact.id + "") {
              cleaned_contacts.push(i);
            }
          }
          return $scope.contacts.sync = cleaned_contacts;
        };
      })(this)).error(function(data) {
        console.log('nope nope nope');
        return console.log(data);
      });
    };
  });

}).call(this);
